{contentType text}
<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<manialink name="EvoSC:key-binds" id="key-binds" version="3">
    <script><!--
    #Include "MathLib" as ML
    #Include "TextLib" as TL

    #Struct Bind {
        Integer code;
        Text name;
        Text def;
        Text id;
    }

    declare Bind[] KeyBinds;
    declare Integer[Text] KeyCooldown;

    Void SendKeyBind(Text bindId) {
        if(KeyCooldown.existskey(bindId)){
            if(KeyCooldown[bindId] + 850 > Now){
                return;
            }
        }

        TriggerPageAction("bound_key_pressed," ^ bindId);
        KeyCooldown[bindId] = Now;
    }

    main(){
        KeyBinds.fromjson("""{$binds->toJson()|noescape}""");

        while (True) {
            yield;

            foreach (event in PendingEvents) {
                if(event.Type == CMlScriptEvent::Type::KeyPress){
                    foreach(bind in KeyBinds){
                        if(bind.code != 0 && event.KeyCode == bind.code){
                            SendKeyBind(bind.id);
                            break;
                        }else if(event.KeyName == bind.def){
                            SendKeyBind(bind.id);
                            break;
                        }
                    }
                }
            }
        }
    }
    --></script>
</manialink>