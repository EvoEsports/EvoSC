{contentType text}
{extends 'Components.window'}

{php $window_width = '84';}
{php $window_height = 3 + count($matches) * 5;}

{block id}recorded-matches{/block}

{block icon}

{/block}

{block title}
Recorded Matches
{/block}

{block content}
<frame pos="0 -2">
    {foreach $matches as $i => $match}
    <label id="text" class="text-light" pos="0 {$i * -5}" text="{$match->dir}" size="50 4" valign="center" autonewline="1" />
    <label id="text" class="text-light" pos="25 {$i * -5}" text="{$match->date}" size="50 4" valign="center" autonewline="1" />
    <label id="text" class="btn-muted download" pos="70 {$i * -5}" text=" Download" textsize="0.5" size="20 4" ScriptEvents="1" data-dir="{$match->dir}" />
    {/foreach}
</frame>
{/block}

<script><!--
{block globals}
{/block}

{block functions}
Boolean hasOpenplanet() {
  return TL::RegexFind("^Openplanet [0-9\\.]+ \\([^,]+, [^\\)]+\\)$", System.ExtraTool_Info, "g").count == 1;
}
{/block}

{block loop}
{/block}

{block bootScript}
{/block}

{block pendingEvents}
    if(event.Type == CMlScriptEvent::Type::MouseClick && event.Control.HasClass("download")){
        if(!hasOpenplanet()){
            confirm("You need Openplanet to download the files.");
            continue;
        }

        TriggerPageAction("ms.download," ^ event.Control.DataAttributeGet("dir"));
    }
{/block}
--></script>
